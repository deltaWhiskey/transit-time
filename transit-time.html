<html>
	<head>
		<title>Transit Time</title>
		<style>
		body {
			font-family: sans-serif;
		}
		button {
			font-weight: bold;
			font-size: 1.2em;
			padding: 1em;
		}
		.error {
			color: maroon;
			font-weight: bold;
		}
		.hide {
			display: none;
		}
		</style>
	</head>
	<body>
		<h1>Transit Time Calculator</h1>
		<p>How long would it take a space ship to travel between two points? This calculator gives a general idea. This calculator comes with caveats, so don't rely on this for actual astrogation or your rocket science homework.</p>

		<form>
			<table border="1" cellpadding="10">
				<tr>
					<td>Acceleration:</td>
					<td><input id="acceleration" value="1"/> Earth gravities (1 gravity = 9.81 meters per second per second)</td>
				</tr>
				<tr>
					<td>Distance to travel:</td>
					<td>
						<input id="distance_years" value="1"/> light years<br/>
						<input id="distance_minutes" value="0"/> light minutes
					</td>
				</tr>
				<tr>
					<td>Fuel available:</td>
					<td>
						<input type="checkbox" id="fuel_infinite" checked="checked"> infinite fuel
						<div id="fuel_limits" class="hide">
							<input id="fuel_years" value="0"/> years<br/>
							<input id="fuel_days" value="60"/> days<br/>
							<input id="fuel_hours" value="0"/> hours
						</div>
					</td>
				</tr>
			</table>
		</form>

		<button id="simulate">run simulation</button>
		<div id="error" class="error"></div>
		<div id="output"></div>

		<h2>Distance Examples</h2>
		<ul>
			<li>3.3 light minutes - Sun to Mercury</li>
			<li>6 light minutes - Sun to Venus</li>
			<li>8.3 light minutes - Sun to Earth (1 astronomical unit)</li>
			<li>12.7 light minutes - Sun to Mars</li>
			<li>43 light minutes - Sun to Jupiter</li>
			<li>78 light minutes - Sun to Saturn</li>
			<li>162 light minutes - Sun to Uranus</li>
			<li>252 light minutes - Sun to Neptune</li>
			<li>4.2 light years - Earth to nearest star</li>
			<li>5 light yearas - typical distance between nearest stars in Earth's neighborhood. Distance between nearest stars can vary a lot. Stars are packed closer together near the galactic core, and farther apart near the rim. Stars can be very close together, in the case of a binary star.</li>
			<li>105,700 light years - diameter of the Milky Way galaxy</li>
		</ul>

		<h2>Caveats</h2>
		<ul>
			<li>A real spacecraft uses up fuel as it goes. Over time, its mass drops and its acceleration increases. This calculator ignores that. To learn more, search the internet for "the tyranny of the rocket equation."</li>
			<li>This calculator assumes a ship can flip around and go from acceleration to deceleration instantly.</li>
			<li>Humans can survive a limited amount of acceleration. 1G (Earth gravity) is no problem. Astronauts experience 3Gs during rocket lift off. Humans can survive 9Gs briefly. Vibration makes G forces more dangerous. Protective clothing and careful positioning makes G forces more survivable.</li>
		</ul>

		<h2>TO DO</h2>
		<ul>
			<li>toggle decelerate or not?</li>
			<li>objective time, subjective time</li>
			<li>fuel limits</li>
		</ul>
		<script type="text/javascript">

		// If "infinite fuel" box is checked, hide fuel inputs
		function toggleFuel() {
			if (document.getElementById('fuel_infinite').checked) {
				document.getElementById('fuel_limits').classList.add('hide');
			} else {
				document.getElementById('fuel_limits').classList.remove('hide');
			}
		}

		// Do the math
		function simulate() {

			// results
			let result = {
				max_speed: 0,
				accelerate_minutes: 0,
				drift_minutes: 0
			};

			// derived variables
			let fuel, // minutes of fuel
				distance, // light minutes to travel
				lmpm; // acceleration as light minutes per minute

			let out = gatherInput();
			if (out.error != '') {
				document.getElementById('error').innerHTML = out.error;
				return;
			}
			fuel = out.fuel;
			distance = out.distance;
			lmpm = out.lmpm;

			// Get travel time if acceleration is the only limiting factor
			result.accelerate_minutes = Math.sqrt( (distance / 2) / (lmpm / 2) );

			if (! fuel_infinite && result.accelerate_minutes > fuel / 2) {
				// Fuel is a limiting factor. Recalculate.
				result.accelerate_minutes = fuel / 2;
			}
console.log(result.accelerate_minutes);
		}

		// Gather input, return object.
		function gatherInput() {
			const g_to_c = 0.000001963358264; // 1G acceleration in light minutes per minute
			const output = {};
			const input = {
				'acceleration' : 0,
				'distance_years' : 0,
				'distance_minutes' : 0,
				'fuel_years' : 0,
				'fuel_days' : 0,
				'fuel_hours' : 0
			};

			// Read numeric input
			for ( const key in input ) {
				const field = document.getElementById(key);
				let float_value = parseFloat(field.value);
				if (isNaN(float_value)) {
					field.value = 0;
				}
				input[key] = parseFloat(field.value);
			};

			// Read non-numeric input
			input.fuel_infinite = document.getElementById('fuel_infinite').checked;

			// Derive values
			output.fuel = 60 * (input.fuel_hours + ( input.fuel_days * 24 ) + ( input.fuel_years * 24 * 365 ) );
			output.distance = input.distance_minutes + ( input.distance_years * 365 * 24 * 60 );
			output.lmpm = g_to_c * input.acceleration;

			// Bounds checking
			output.error = '';
			if (output.lmpm <= 0) {
				output.error += '<p>Please enter a positive acceleration</p>';
			}
			if (output.distance <= 0) {
				output.error += '<p>Please enter a positive distance</p>';
			}
			if (! output.fuel_infinite && output.fuel <= 0) {
				output.error += '<p>Please enter a positive fuel amount</p>';
			}

			return output;
		}

		document.getElementById('fuel_infinite').addEventListener('click', toggleFuel);
		document.getElementById('simulate').addEventListener('click', simulate);
		</script>
	</body>
</html>
